{% extends "base.html" %}
{% block title %}Owner Dashboard{% endblock %}
{% block content %}

<div class="flex justify-between items-center mb-8">
  <div>
    <h1 class="text-4xl font-extrabold text-gray-800">Owner Dashboard ğŸ¢</h1>
    <p class="text-gray-500 mt-1">Manage your parking lots and slots</p>
  </div>
  <a href="{% url 'parking_create' %}" 
     class="bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 rounded-xl font-bold hover:shadow-lg transition transform hover:-translate-y-0.5">
    + Add Parking Lot
  </a>
</div>

{% if lots %}
<div class="space-y-8">
  {% for lot in lots %}
  <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">

    <!-- Lot Header -->
    <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6">
      <div class="flex justify-between items-start">
        <div>
          <h3 class="text-2xl font-bold">{{ lot.name }}</h3>
          <p class="text-blue-100 mt-1">ğŸ“ {{ lot.city }} â€” {{ lot.address }}</p>
        </div>
        <div class="text-right">
          <span class="bg-white/20 px-3 py-1 rounded-full text-sm font-semibold">
            {{ lot.slots.count }}/{{ lot.total_slots }} Slots
          </span>
        </div>
      </div>

      <!-- Lot Stats Row -->
      <div class="grid grid-cols-3 gap-4 mt-4">
        <div class="bg-white/10 rounded-xl p-3 text-center">
          <p class="text-2xl font-bold">{{ lot.slots.count }}</p>
          <p class="text-xs text-blue-100 mt-1">Total Slots</p>
        </div>
        <div class="bg-white/10 rounded-xl p-3 text-center">
          <p class="text-2xl font-bold text-green-300">
            {{ lot.slots.all|length }}
          </p>
          <p class="text-xs text-blue-100 mt-1">Active Slots</p>
        </div>
        <div class="bg-white/10 rounded-xl p-3 text-center">
          <p class="text-2xl font-bold text-red-300">
            {% with total=lot.slots.count active=lot.slots.all|length %}
            {{ total }}
            {% endwith %}
          </p>
          <p class="text-xs text-blue-100 mt-1">Inactive Slots</p>
        </div>
      </div>
    </div>

    <!-- Slots List -->
    <div class="p-6">
      <div class="flex justify-between items-center mb-4">
        <h4 class="text-lg font-bold text-gray-700">All Slots</h4>
        <a href="{% url 'add_slot' lot.id %}"
           class="bg-blue-600 text-white px-4 py-2 rounded-xl text-sm font-bold hover:bg-blue-700 transition">
          + Add Slot
        </a>
      </div>

      {% if lot.slots.all %}
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
        {% for slot in lot.slots.all %}
        <div class="border rounded-xl p-4 {% if slot.is_active %}border-green-200 bg-green-50{% else %}border-red-200 bg-red-50{% endif %}">
          <div class="flex justify-between items-start mb-3">
            <div>
              <p class="font-bold text-gray-800">Slot {{ slot.slot_number }}</p>
              <p class="text-sm text-gray-500 mt-0.5">{{ slot.slot_type }} Â· â‚¹{{ slot.hourly_rate }}/hr</p>
            </div>
            <!-- Active/Inactive Badge -->
            <span class="px-2 py-1 rounded-full text-xs font-bold {% if slot.is_active %}bg-green-200 text-green-800{% else %}bg-red-200 text-red-800{% endif %}">
              {% if slot.is_active %}â— Active{% else %}â— Inactive{% endif %}
            </span>
          </div>

          <!-- Toggle Button -->
          <form method="POST" action="{% url 'toggle_slot' slot.id %}">
            {% csrf_token %}
            <button type="submit"
              class="w-full py-2 rounded-lg text-sm font-bold transition
              {% if slot.is_active %}
                bg-red-100 text-red-700 hover:bg-red-200
              {% else %}
                bg-green-100 text-green-700 hover:bg-green-200
              {% endif %}">
              {% if slot.is_active %}
                ğŸ”´ Deactivate
              {% else %}
                ğŸŸ¢ Activate
              {% endif %}
            </button>
          </form>
        </div>
        {% endfor %}
      </div>

      {% else %}
      <div class="text-center py-8 text-gray-400">
        <p class="text-4xl mb-2">ğŸ…¿ï¸</p>
        <p>No slots added yet. Click "+ Add Slot" to get started.</p>
      </div>
      {% endif %}
    </div>

  </div>
  {% endfor %}
</div>

{% else %}
<div class="text-center py-20 bg-white rounded-2xl shadow">
  <div class="text-6xl mb-4">ğŸ—ï¸</div>
  <h3 class="text-2xl font-bold text-gray-700 mb-2">No Parking Lots Yet</h3>
  <p class="text-gray-500 mb-6">Start by adding your first parking lot</p>
  <a href="{% url 'parking_create' %}" 
     class="bg-blue-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-blue-700 transition">
    Add Parking Lot
  </a>
</div>
{% endif %}
<!-- BOOKINGS SECTION -->
<div class="mt-10">
  <h2 class="text-2xl font-bold text-gray-800 mb-6">ğŸ“‹ Bookings on Your Slots</h2>

  {% if owner_reservations %}
  <div class="bg-white rounded-2xl shadow-lg overflow-hidden border border-gray-100">

    <!-- Table Header -->
    <div class="grid grid-cols-6 gap-4 p-4 bg-gradient-to-r from-blue-600 to-purple-600 text-white text-sm font-bold">
      <div>Customer</div>
      <div>Slot</div>
      <div>Lot</div>
      <div>From â†’ To</div>
      <div>Amount</div>
      <div>Status</div>
    </div>

    <!-- Table Rows -->
    {% for res in owner_reservations %}
    <div class="grid grid-cols-6 gap-4 p-4 border-b border-gray-100 hover:bg-gray-50 transition items-center">
      
      <!-- Customer -->
      <div>
        <p class="font-semibold text-gray-800">{{ res.customer.username }}</p>
        <p class="text-xs text-gray-400">{{ res.customer.email }}</p>
      </div>

      <!-- Slot -->
      <div>
        <p class="font-semibold text-gray-700">Slot {{ res.slot.slot_number }}</p>
        <p class="text-xs text-gray-400">{{ res.slot.slot_type }}</p>
      </div>

      <!-- Lot -->
      <div>
        <p class="text-sm text-gray-600">{{ res.slot.lot.name }}</p>
      </div>

      <!-- Time -->
      <div>
        <p class="text-xs text-gray-600">ğŸ• {{ res.start_time|date:"M d, Y" }}</p>
        <p class="text-xs text-gray-600">{{ res.start_time|date:"H:i" }} â†’ {{ res.end_time|date:"H:i" }}</p>
      </div>

      <!-- Amount -->
      <div>
        <p class="font-bold text-green-600">â‚¹{{ res.total_amount }}</p>
      </div>

      <!-- Status Badge -->
      <div>
        <span class="px-3 py-1 rounded-full text-xs font-bold
          {% if res.status == 'CONFIRMED' %}bg-green-100 text-green-700
          {% elif res.status == 'PENDING' %}bg-yellow-100 text-yellow-700
          {% elif res.status == 'CANCELLED' %}bg-red-100 text-red-700
          {% else %}bg-gray-100 text-gray-600{% endif %}">
          {{ res.status }}
        </span>
      </div>

    </div>
    {% endfor %}

  </div>

  <!-- Summary Stats -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mt-6">
    <div class="bg-blue-50 rounded-xl p-4 text-center border border-blue-100">
      <p class="text-2xl font-bold text-blue-600">{{ owner_reservations.count }}</p>
      <p class="text-sm text-blue-500 mt-1">Total Bookings</p>
    </div>
    <div class="bg-green-50 rounded-xl p-4 text-center border border-green-100">
      <p class="text-2xl font-bold text-green-600">
        {{ owner_reservations|length }}
      </p>
      <p class="text-sm text-green-500 mt-1">Confirmed</p>
    </div>
    <div class="bg-yellow-50 rounded-xl p-4 text-center border border-yellow-100">
      <p class="text-2xl font-bold text-yellow-600">
        {{ owner_reservations|length }}
      </p>
      <p class="text-sm text-yellow-500 mt-1">Pending</p>
    </div>
    <div class="bg-purple-50 rounded-xl p-4 text-center border border-purple-100">
      <p class="text-2xl font-bold text-purple-600">
          â‚¹{{ total_earned }}
      </p>
      <p class="text-sm text-purple-500 mt-1">Total Earned</p>
    </div>
  </div>

  {% else %}
  <div class="bg-white rounded-2xl shadow p-12 text-center border border-gray-100">
    <div class="text-5xl mb-4">ğŸ“­</div>
    <h3 class="text-xl font-bold text-gray-600 mb-2">No Bookings Yet</h3>
    <p class="text-gray-400">When customers book your slots, they will appear here.</p>
  </div>
  {% endif %}
</div>

{% endblock %}
